# Security Audit Report

**Scan Time:** 2026-02-04 21:20  
**Scope:** /Users/masmilon/.claude/claude-code  
**Files Scanned:** 24  
**Risk Score:** ðŸ”´ CRITICAL

---

## Executive Summary

Found **1 CRITICAL** security issue: a hardcoded Discord webhook URL that allows anyone to send messages to your Discord channel. Also found **1 MEDIUM** risk (exec usage - acceptable in context).

---

## Issues by Severity

### ðŸ”´ CRITICAL: Hardcoded Discord Webhook URL

**File:** `plugins/sop-workflow/hooks/notify-delete.sh:9`

**Code:**
```bash
DISCORD_WEBHOOK="${DISCORD_WEBHOOK_URL:-https://discord.com/api/webhooks/REDACTED/REDACTED}"
```

**Risk:** Anyone who finds this webhook URL can:
- Send spam/malicious messages to your Discord channel
- Impersonate system notifications
- Potentially phish or social engineer you

**Remediation:**
1. Delete the webhook in Discord Developer Portal and create a new one
2. Replace the hardcoded URL with a placeholder
3. Use environment variable `DISCORD_WEBHOOK_URL` instead

---

### ðŸŸ¡ MEDIUM: Shell Execution (Acceptable)

**File:** `plugins/sop-workflow/discord-bot/keyboard/applescript.js:30`

**Code:**
```javascript
exec(`osascript -e '${escapedScript}'`, (error, stdout, stderr) => {
```

**Assessment:** This is **acceptable** because:
- The script content is internally generated, not user-supplied
- Input is properly escaped (line 29)
- Required for AppleScript execution on macOS
- Well-documented with security comments

**Status:** No action required

---

## Clean Files âœ…

22 files passed all security checks:
- All config files (except noted)
- All JavaScript files (except applescript.js - reviewed and acceptable)
- All shell scripts (except notify-delete.sh)

---

## Recommendations

### Priority 1: IMMEDIATE ACTION REQUIRED

1. **Invalidate the exposed webhook:**
   - Go to Discord Developer Portal â†’ Webhooks
   - Delete webhook ID `REDACTED`
   - Create a new webhook

2. **Fix notify-delete.sh:**
   ```bash
   # Change line 9 from hardcoded URL to:
   DISCORD_WEBHOOK="${DISCORD_WEBHOOK_URL:-YOUR_WEBHOOK_URL_HERE}"
   ```

3. **Add to .gitignore (already done for config.json):**
   - Consider creating a `hooks/config.sh` for webhook URLs
   - Add it to .gitignore

### Priority 2: Best Practices

1. **Use environment variables** for all secrets
2. **Create a setup script** that prompts for webhook URLs during installation
3. **Document** that users must set `DISCORD_WEBHOOK_URL` environment variable

---

## Scan Details

### Patterns Checked

| Pattern | Result |
|---------|--------|
| API Keys/Tokens in code | âœ… Clean (after config.json fix) |
| Hardcoded credentials | ðŸ”´ 1 webhook URL found |
| Dynamic code execution (eval/exec) | âœ… 1 found, acceptable |
| Reverse shells | âœ… Clean |
| Base64 encoded payloads | âœ… Clean |
| Suspicious network calls | âœ… Clean |
| chmod 777 / privilege escalation | âœ… Clean |
| SQL injection vectors | âœ… N/A |

### Files Analyzed

- Shell scripts: 10
- JavaScript: 4
- JSON configs: 6
- Other: 4
